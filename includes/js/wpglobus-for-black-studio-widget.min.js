!function(a){"use strict";if("undefined"!=typeof WPGlobusBSWidget){var b={option:{language:WPGlobusCoreData.default_language,content:"",activeClass:"mce-active",button_separator:WPGlobusBSWidget.data.button_separator,text_separator:WPGlobusBSWidget.data.text_separator,icon:WPGlobusBSWidget.data.icon,button:WPGlobusBSWidget.data.button,button_class:WPGlobusBSWidget.data.button_class,button_classes:WPGlobusBSWidget.data.button_classes,pagenow:WPGlobusBSWidget.data.pagenow},language:{},content:{},ajaxActionId:void 0,editor:{},editorKeep:!1,preventChangeEditor:!1,saveCustomizeEditors:!1,init:function(c){b.option=a.extend(b.option,c),"customize.php"==b.option.pagenow?b.onCustomize():"widgets.php"==b.option.pagenow&&(b.addButtons(),b.addListeners(),"tinymce"!=getUserSetting("editor")&&setUserSetting("editor","tinymce"))},onCustomizeElementListeners:function(c){tinymce.get(c.id).on("change",function(c){if(!b.preventChangeEditor){var d=a(c.target.iframeElement).data("widget"),e=WPGlobusCore.TextFilter(c.level.content,WPGlobusCoreData.language);WPGlobusCustomize.controlWidgets[d].element[c.target.id].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[d].element[c.target.id].value,e,WPGlobusCoreData.language)}}),a("#"+c.id).on("change",function(c){if(!b.preventChangeEditor){var d=a(this),e=(d.data("widget"),d.attr("id"));if(tinymce.get(e).isHidden()){WPGlobusCore.TextFilter(d.html(),WPGlobusCoreData.language)}}});var d="#"+WPGlobusCustomize.controlWidgets[c.widget].submit[0].id;a(d).attr("data-editor-id",c.id),a(document).off("mouseenter",d,WPGlobusCustomize.onSubmitEvents).off("mouseleave",d,WPGlobusCustomize.onSubmitEvents).off("click",d,WPGlobusCustomize.onSubmitEvents),a(document).on("mouseenter",d,function(c){b.preventChangeEditor=!0;var d=a(this),e=d.data("editor-id");tinymce.get(e).isHidden()?a("#"+e).val(WPGlobusCustomize.controlWidgets[d.data("widget")].element[e].value):tinymce.get(e).setContent(WPGlobusCustomize.controlWidgets[d.data("widget")].element[e].value),a.each(WPGlobusCustomize.controlWidgets[d.data("widget")].element,function(b,c){b==d.data("editor-id")||a("#"+b).val(c.value)})}).on("mouseleave",d,function(c){if(b.preventChangeEditor=!1,!1===b.editorKeep){var d=a(this),e=d.data("editor-id");tinymce.get(e).isHidden()?a("#"+e).val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[d.data("widget")].element[e].value,WPGlobusCoreData.language,"RETURN_EMPTY")):tinymce.get(e).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[d.data("widget")].element[e].value,WPGlobusCoreData.language,"RETURN_EMPTY")),a.each(WPGlobusCustomize.controlWidgets[d.data("widget")].element,function(b,c){a("#"+b).val(WPGlobusCore.TextFilter(c.value,WPGlobusCoreData.language,"RETURN_EMPTY"))})}}).on("click",d,function(a){b.editorKeep={},b.editorKeep.id=c.id,b.editorKeep.widget=c.widget,b.editorKeep.language=WPGlobusCoreData.language})},onCustomize:function(){a(document).on("wpglobus_customize_control_added_widget",function(c,d){d.indexOf("black-studio")>=0&&setTimeout(function(){a.each(WPGlobusCustomize.controlWidgets[d].element,function(c,e){null!==tinymce.get(c)&&(void 0===b.editor[c]&&(b.editor[c]={}),b.editor[c].id=c,b.editor[c].widget=d,b.editor[c].iframe="#"+c+"_ifr",a(b.editor[c].iframe).addClass("wpglobus-customize-translatable-element").css({width:"99%"}).attr("data-widget",d),b.onCustomizeElementListeners(b.editor[c]))})},1e3)}),a(document).on("ajaxComplete",function(c,d){if(void 0!==d.responseText&&(b.saveCustomizeEditors&&(a.each(WPGlobusBSWidget.editor,function(a,b){tinymce.get(a).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[b.widget].element[a].value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),b.saveCustomizeEditors=!1),d.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")>=0&&b.editorKeep)){if(a(".bstw-loading").css("display","none"),tinymce.get(b.editorKeep.id).isHidden()){WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[b.editorKeep.widget].element[b.editorKeep.id].value,WPGlobusCoreData.language,"RETURN_EMPTY");a("#"+b.editorKeep.id).val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[b.editorKeep.widget].element[b.editorKeep.id].value,WPGlobusCoreData.language,"RETURN_EMPTY"))}else tinymce.get(b.editorKeep.id).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[b.editorKeep.widget].element[b.editorKeep.id].value,b.editorKeep.language,"RETURN_EMPTY"));setTimeout(function(){b.editorKeep=!1},2e3),b.preventChangeEditor=!1}}),a(document).on("wpglobus_customize_control_language",function(b,c){a.each(WPGlobusBSWidget.editor,function(a,b){tinymce.get(a).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[b.widget].element[a].value,c,"RETURN_EMPTY"))})}),a("#save").on("mouseenter",function(b){a.each(WPGlobusBSWidget.editor,function(a,b){tinymce.get(a).setContent(WPGlobusCustomize.controlWidgets[b.widget].element[a].value)})}).on("mouseleave",function(c){b.saveCustomizeEditors||a.each(WPGlobusBSWidget.editor,function(a,b){tinymce.get(a).setContent(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[b.widget].element[a].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})}).on("click",function(a){b.saveCustomizeEditors=!0})},saveContent:function(c,d){var e,f;"object"==typeof c?(e=c.getContent(),f=c.id):(f=c,e=a("#"+f).val()),b.content[f]=WPGlobusCore.getString(b.content[f],e,d)},getTranslation:function(a,c){return WPGlobusCore.getTranslations(b.content[a.id])[c]},removeClass:function(c){a(".mce-"+b.option.button_class+c).removeClass(b.option.activeClass)},fixDialogStartIcon:function(b){var c;void 0===b?a(".widget .wp-editor-area").each(function(d,e){b=a(e).attr("id"),void 0!==(c=a("#"+b).parents(".widget").attr("id"))&&a("#"+c+" .wpglobus_dialog_start.wpglobus_dialog_icon").css("margin-right","20px")}):void 0!==(c=a("#"+b).parents(".widget").attr("id"))&&a("#"+c+" .wpglobus_dialog_start.wpglobus_dialog_icon").css("margin-right","20px")},addAjaxListener:function(c){a(document).ajaxComplete(function(a,c,d){-1!=d.data.indexOf("action=save-widget")&&(-1!=d.data.indexOf("delete_widget=1")||(b.fixDialogStartIcon(b.ajaxActionId),void 0!==b.ajaxActionId&&(window.switchEditors.go(b.ajaxActionId,"tmce"),b.ajaxActionId=void 0)))})},addEditorListener:function(c){var d=a("#"+c).parents(".widget").attr("id");void 0!==d&&a("#"+d+" .widget-control-save").on("click",function(d){d.preventDefault(),null==tinymce.get(c)||tinymce.get(c).isHidden()?a("#"+c).val(b.content[c]):tinymce.get(c).setContent(b.content[c]),b.ajaxActionId=c})},addListeners:function(){b.addAjaxListener(),a(document).on("click",".widget-title, .widget-title-action",function(b){b.preventDefault();var c=a(this).parents(".widget").attr("id");window.switchEditors.go(a("#"+c).find(".wp-editor-area").attr("id"),"tmce")})},addButtons:function(){tinymce.PluginManager.add(b.option.button_separator,function(a,c){a.addButton(b.option.button_separator,{text:b.option.text_separator,icon:b.option.icon})}),a.each(WPGlobusCoreData.enabled_languages,function(c,d){tinymce.PluginManager.add(b.option.button+d,function(c,e){var f="";c.id.indexOf("widget-black-studio-")>=0&&d==WPGlobusCoreData.default_language&&(b.fixDialogStartIcon(c.id),b.addEditorListener(c.id),b.content[c.id]=a("#"+c.id).text(),b.language[c.id]=b.option.language,a("#"+c.id).val(b.getTranslation(c,d)),f=" active",c.on("keyup",function(a,d){b.saveContent(c,b.language[c.id])}),a(document).on("change","#"+c.id,function(c){var d=a(this).attr("id");tinymce.get(d).isHidden()&&b.saveContent(d,b.language[d])})),c.addButton(b.option.button+d,{text:WPGlobusCoreData.en_language_name[d],icon:!1,tooltip:"Select "+WPGlobusCoreData.en_language_name[d]+" language",value:d,classes:b.option.button_classes+f+" "+b.option.button_class+d+" "+b.option.button_class+c.id,onclick:function(){var d=a(this),e=d[0]._id,f=WPGlobusCoreData.default_language;void 0!==d[0]._value?f=d[0]._value:void 0!==d[0].settings.value&&(f=d[0].settings.value),b.removeClass(c.id),a("#"+e).addClass(b.option.activeClass),b.saveContent(c,b.language[c.id]),b.language[c.id]=f,c.setContent(b.getTranslation(c,b.language[c.id]))}})})})}};WPGlobusBSWidget=a.extend({},WPGlobusBSWidget,b),WPGlobusBSWidget.init()}}(jQuery);